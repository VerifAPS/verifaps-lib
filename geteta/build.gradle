
plugins {}

apply plugin: 'antlr'

description = """
    Generalized Test Table
"""

version = "0.10"

def antlrOutputDir = file("${project.buildDir}/generated-src/antlr/main/edu/kit/iti/formal/automation/testtables/grammar")


repositories {
    mavenCentral()
    mavenLocal()
    maven { url 'https://jitpack.io' }
}

dependencies {
    api project(':symbex')
    antlr group: 'org.antlr', name: 'antlr4', version: '4.13.1'
    api 'com.github.jferard:fastods:0.8.1'
    api 'com.github.ajalt:clikt:3.5.2'

    api 'com.github.doyaaaaaken:kotlin-csv-jvm:1.9.2'

    //compile 'io.github.config4k:config4k:0.4.1'

    //compile group: 'javax.xml.bind', name: 'jaxb-api', version: '2.4.0-b180830.0359'
    //compile group: 'com.sun.xml.bind', name: 'jaxb-impl', version: '2.4.0-b180830.0438'
    //compile group: 'com.sun.xml.bind', name: 'jaxb-core', version: '2.3.0.1'

    //compile group: 'org.codehaus.groovy', name: 'groovy-all', version: '3.0.0-beta-1', ext: 'pom'
    //compile group: 'org.jetbrains.kotlin', name: 'kotlin-compiler', version: '1.3.31'
}

sourceSets {
    main {
        java {
            srcDirs "src/main/java", file("${project.buildDir}/generated-src/antlr/main")
        }
    }
}

idea {
    module {
        // if you hate browsing Javadoc
        downloadJavadoc = false

        // and love reading sources :)
        downloadSources = true
    }
}


generateGrammarSource {
    outputDirectory antlrOutputDir
    arguments << '-package' << 'edu.kit.iti.formal.automation.testtables.grammar'
    arguments << '-visitor'
}


compileJava.dependsOn generateGrammarSource
compileKotlin.dependsOn generateGrammarSource

compileTestKotlin.dependsOn generateTestGrammarSource


/*
license {
    mapping("java", "PHP")
    mapping("kt", "PHP")

    header = file("gradle/HEADER")
    ext.name = "geteta"
    ext.holder = "Alexander Weigl <weigl@kit.edu>"
    ext.year = "2016-2018"
    exclude "*.xml"
    exclude "*.g4"
    exclude "*.smv"
}

//Checks does not work
licenseMain.enabled = false
licenseTest.enabled = false
*/

/*
task jarDist(type: Jar) {
    classifier = "exe"
    entryCompression = ZipEntryCompression.DEFLATED
    with jar
    manifest {
        attributes "Main-Class": "edu.kit.iti.formal.automation.testtables.Geteta"
    }

    from {
        sourceSets.main.output
        configurations.compile.collect { it.isDirectory() ? it : zipTree(it) }
    }
}
jarDist.dependsOn jar
*/

task run(type: JavaExec) {
    group = "run"
    classpath = sourceSets.main.runtimeClasspath
    main = 'edu.kit.iti.formal.automation.testtables.apps.Geteta'
    if (project.hasProperty("appArgs")) {
        args Eval.me(project.property("appArgs"))
    }
}

test {
    exclude '**/AutomataDrawerTest.class'
    exclude '**/SmtEncoderTest.class'
    exclude '**/FullStackTest.class'
    exclude "**/SMVModuleBuilderTest.class"
}


